"use strict";var express=require("express"),path=require("path"),mongoose=require("mongoose"),mongodb=require("mongodb"),session=require("express-session"),cookieParser=require("cookie-parser"),passportLocalMongoose=require("passport-local-mongoose"),logger=require("morgan"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy;passport.use(new LocalStrategy(function(e,s,o){Account.findOne({username:e},function(e,r){return e?o(e):r?r.validPassword(s)?o(null,r):o(null,!1,{message:"Incorrect password."}):o(null,!1,{message:"Incorrect username."})})}));var ship=require("./models/ship");require("dotenv").config();var connectionString=process.env.MONGO_CON;(mongoose=require("mongoose")).connect(connectionString,{useNewUrlParser:!0,useUnifiedTopology:!0});var db=mongoose.connection;db.on("error",console.error.bind(console,"MongoDB connectionerror:")),db.once("open",function(){console.log("Connection to DB succeeded")});var indexRouter=require("./routes/index"),usersRouter=require("./routes/users"),appRouter=require("./routes/ship"),selectorRouter=require("./routes/selector"),resourceRouter=require("./routes/resource"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","pug"),app.use(logger("dev")),app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.use(cookieParser()),app.use(require("express-session")({secret:"keyboard cat",resave:!1,saveUninitialized:!1})),app.use(passport.initialize()),app.use(passport.session()),app.use(express.static(path.join(__dirname,"public"))),app.use("/",indexRouter),app.use("/users",usersRouter),app.use("/ship",appRouter),app.use("/selector",selectorRouter),app.use("/resource",resourceRouter);var Account=require("./models/account");function recreateDB(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(ship.deleteMany());case 2:new ship({Model:"battleship",yearofmanufacturing:2022,color:"Red"}).save().then(function(e){console.log("First ship details saved")}).catch(function(e){console.error(e)}),new ship({Model:"cruiser",yearofmanufacturing:2011,color:"silver"}).save().then(function(e){console.log("Second ship details saved")}).catch(function(e){console.error(e)}),new ship({Model:" destroyer",yearofmanufacturing:2023,color:" Blue"}).save().then(function(e){console.log("Third ship details saved")}).catch(function(e){console.error(e)});case 8:case"end":return e.stop()}})}passport.use(new LocalStrategy(Account.authenticate())),passport.serializeUser(Account.serializeUser()),passport.deserializeUser(Account.deserializeUser());var reseed=!0;reseed&&recreateDB(),app.use(function(e,r,s){s(createError(404))}),app.use(function(e,r,s,o){s.locals.message=e.message,s.locals.error="development"===r.app.get("env")?e:{},s.status(e.status||500),s.render("error")}),module.exports=app;
//# sourceMappingURL=app.min.js.map
